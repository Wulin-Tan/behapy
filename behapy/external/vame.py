from . import vame_core as core

def help():
    print("VAME (Variational Animal Motion Embedding) is available via 'behapy.external.vame.core'.")
    print("Example usage:")
    print("  from behapy.external.vame import core as vame")
    print("  vame.init_new_project(...)")

# Expose core modules directly
from .vame_core import (
    initialize_project,
    model,
    analysis,
    util
)

import numpy as np

def load_results(adata, latent_path, labels_path=None, key_added='vame'):
    """
    Load VAME analysis results (latent vectors and cluster labels) into AnnData.
    
    Args:
        adata: BehapyData object.
        latent_path: Path to the 'latent_vector_*.npy' file generated by VAME.
        labels_path: Path to the labels/clusters .npy file (optional).
        key_added: Prefix for added keys (default: 'vame').
                   Adds .obsm['X_{key_added}'] and .obs['{key_added}_cluster'].
    
    Returns:
        adata: Updated BehapyData object.
    """
    # Load latent vectors
    latent = np.load(latent_path)
    
    # Handle length mismatch (VAME often truncates time window)
    if len(latent) != adata.n_obs:
        pad_len = adata.n_obs - len(latent)
        if pad_len > 0:
            # Pad with NaNs at the end (assuming truncation happens at end/start)
            # Note: User should verify alignment. VAME usually truncates start/end.
            # Here we pad the end for simplicity, but print a warning.
            print(f"Warning: Latent vector length ({len(latent)}) does not match adata ({adata.n_obs}). Padding with NaNs.")
            latent = np.pad(latent, ((0, pad_len), (0, 0)), mode='constant', constant_values=np.nan)
        else:
            print(f"Warning: Latent vector length ({len(latent)}) > adata ({adata.n_obs}). Truncating.")
            latent = latent[:adata.n_obs]

    adata.obsm[f'X_{key_added}'] = latent
    
    # Load labels if provided
    if labels_path:
        labels = np.load(labels_path)
        if len(labels) != adata.n_obs:
            pad_len = adata.n_obs - len(labels)
            if pad_len > 0:
                labels = np.pad(labels, (0, pad_len), mode='constant', constant_values=-1)
            else:
                labels = labels[:adata.n_obs]
        
        adata.obs[f'{key_added}_cluster'] = labels.astype(str)
        # Convert -1 (padded) to NaN or similar if needed
        adata.obs.loc[adata.obs[f'{key_added}_cluster'] == '-1', f'{key_added}_cluster'] = np.nan
        
    return adata
